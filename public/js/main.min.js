const dateInfo=new Date,dateCalendar=new Date(dateInfo.getTime()),day=dateInfo.getDate(),weekday=dateInfo.toLocaleString("uk-UA",{weekday:"long"}),month=dateInfo.toLocaleString("uk-UA",{month:"numeric"}),year=dateInfo.getFullYear();function disableScroll(){document.body.style.overflow="hidden"}function enableScroll(){document.body.style.overflow=""}const db=new Dexie("todoList");async function sliderCardWatch(){$(".slider").hasClass("slick-initialized")&&$(".slider").slick("unslick"),$(".card-container > .card").length>=1&&$(".card").each((function(){$(this).remove()})),await db.cardinfo.toCollection().count().then((a=>{if(a>=1)db.cardinfo.toArray().then((a=>{a.forEach(((a,t)=>{if(t>=10)return;const e=$("<div></div>");0===t?e.addClass("card slide card-today"):e.addClass("card slide");const d=$("<div></div>").addClass("card-header"),n=$("<div></div>").addClass("card-title").text(a.titleCard),o=$("<div></div>").addClass("card-date").text(a.dateCard),l=$("<div></div>").addClass("card-body"),c=$("<ul></ul>").addClass("card-list");$(".card-container").removeClass("flex-img").addClass("flex-card").append(e),$(".card-container").find(".card-img").remove(),e.append(d),e.append(l),d.append(o).append(n),l.append(c),a.ArrayList.forEach((a=>{const t=$("<li></li>"),e=$("<input/>").addClass("task-input-checkbox").attr("type","checkbox").attr("checked",a.value).attr("disabled",!0),d=$("<p></p>").addClass("task-input-text").text(a.name);a.value?d.css("text-decoration","line-through").css("color","gray"):d.css("text-decoration","none").css("color","black"),t.append(e).append(d),c.append(t)}));const r=$("<div></div>").addClass("card-more"),i=$("<img>").addClass("card-more-icon").attr("src","img/drop.svg").attr("alt","Більше");r.append(i),e.append(r)})),$(".slider").slick({infinite:!1,slidesToShow:3,slidesToScroll:1,variableWidth:!0,responsive:[{breakpoint:768,settings:{slidesToShow:1}}]});let t=$("<img/>").attr("src","img/right.svg");$(".slick-next").text("").append(t),t=$("<img/>").attr("src","img/left.svg"),$(".slick-prev").text("").append(t)}));else{const a="img/Sandy_Edu-03_Single-02.jpg",t=$("<img/>").addClass("card-img").attr("src",a).attr("alt","Додайте завдання");$(".card-container").removeClass("flex-card").addClass("flex-img").append(t)}}))}async function sliderData(a){await db.cardinfo.where("titleCard").equals(`${a}`).each((a=>{$(".modal-popup .modal-date").text(a.dateCard),$(".modal-popup .modal-title").text(a.titleCard);const t=$("<ul></ul>").addClass("modal-list");a.ArrayList.forEach(((e,d)=>{const n=$("<li></li>"),o=$("<input/>").addClass("task-input-checkbox").attr("type","checkbox").attr("checked",e.value),l=$("<p></p>").addClass("task-input-text").text(e.name);e.value&&l.css("text-decoration","line-through").css("color","gray"),o.on("change",(async()=>{const t=!e.value;t?l.css("text-decoration","line-through").css("color","gray"):l.css("text-decoration","none").css("color","black");const n=a.ArrayList.map(((a,e)=>e===d?{...a,value:t}:a));try{await db.cardinfo.update(a.id,{ArrayList:n}),console.log("Значение успешно обновлено в базе данных.")}catch(a){console.error("Ошибка обновления в базе данных:",a)}})),n.append(o).append(l),t.append(n)})),$(".modal-icon-img").off("click").on("click",(async()=>{try{await db.cardinfo.delete(a.id),console.log(`Элемент с ID ${a.id} удален из базы данных.`),$(".modal-popup .modal-body").empty()}catch(a){console.error("Ошибка при удалении элемента:",a)}$(".popup-overlay").fadeOut(),$(".modal-popup").fadeOut(),enableScroll(),await sliderCardWatch(),await updateCalendar()})),$(".modal-popup .modal-body").empty().append(t)}))}async function addDate(a,t,e){try{await db.cardinfo.add({titleCard:a,dateCard:t,ArrayList:e}),console.log(e)}catch(a){console.error("Ошибка при добавлении данных в IndexedDB:",a)}}function addTask(){const a=$(".input-task"),t=$("<div></div>").addClass("task"),e=$("<input/>").addClass("task-input-checkbox").attr("type","checkbox"),d=$("<input/>").addClass("task-input-text").attr("type","text").attr("placeholder","Дойдате завдання");a.append(t),t.append(e).append(d)}$(document).ready((async()=>{await db.version(1).stores({cardinfo:"++id,titleCard,dateCard,ArrayList"}),await db.open().catch((a=>{console.error("Ошибка при открытии базы данных:",a)})),await sliderCardWatch()})),$(".task-save").click((async function(){const a=$("#task-title").val(),t=$("#modal-date-create").val(),e=[];if($(".task:visible").each((function(){const a=$(this).find(".task-input-text").val();e.push({name:a,value:!1})})),a.trim()){try{await addDate(a,t,e)}catch(a){console.error("Ошибка при добавлении данных:",a)}$(".popup-overlay").fadeOut(),$(".modal-popup-create").fadeOut(),enableScroll(),await sliderCardWatch(),await updateCalendar()}else alert("Название задачи не может быть пустым.")})),$(document).ready((function(){$("#datetime-day-info").text(day),$("#datetime-day-info").each((function(){$(this).prop("day",0).animate({day:$(this).text()},{duration:1500,easing:"swing",step:function(a){$(this).text(Math.ceil(a))}})})),function a(t,e,d=0){d<t.length&&($("#datetime-date-weekday").text($("#datetime-date-weekday").text()+t.charAt(d)),setTimeout((()=>a(t,e,d+1)),e))}(weekday[0].toUpperCase()+weekday.slice(1),40),$("#datetime-date-month").text(`.${month}`)})),$(document).ready((async()=>{const a=a=>{const t=window.innerWidth>768?14:6;return a.length>t?a.slice(0,t)+"...":a};async function t(){const t=dateCalendar.toLocaleString("uk-UA",{month:"long"}),e=dateCalendar.getFullYear();$("#month-name").text(`${t[0].toUpperCase()+t.slice(1)} ${e}`);const d=new Date(dateCalendar.getFullYear(),dateCalendar.getMonth(),1).getDay(),n=new Date(dateCalendar.getFullYear(),dateCalendar.getMonth()+1,0).getDate(),o=$(".calendar-body").empty();let l=1,c=1;for(let t=0;t<6;t++){const r=$("<tr></tr>");for(let o=1;o<8;o++){const i=$("<td></td>"),s=$("<span></span>").addClass("calendar-day"),p=$("<span></span>").addClass("calendar-task");0===t&&o<d?r.append(i):l<=n?(s.text(l),i.append(s),await db.cardinfo.where("dateCard").equals(`${l}.${dateCalendar.getMonth()+1<=9?`0${dateCalendar.getMonth()+1}`:dateCalendar.getMonth()+1}.${e}`).first((t=>{if(t){const e=$("<span></span>");e.text(a(t.titleCard)),p.append(e)}})),i.append(p),r.append(i),l++):(s.text(c).addClass("nextMonth"),i.append(s).addClass("calendar-dayNext"),r.append(i),c++)}if(o.append(r),l>n)break}}$("#next-month").click((async()=>{dateCalendar.setMonth(dateCalendar.getMonth()+1),await t()})),$("#prev-month").click((async()=>{dateCalendar.setMonth(dateCalendar.getMonth()-1),await t()})),$("#today").click((async()=>{dateCalendar.setMonth(dateInfo.getMonth()),dateCalendar.setFullYear(year),await t()})),$("#watchCalendar").click((()=>{$("#calendar-table").fadeIn(),$(".task-container").fadeOut()})),$("#watchTask").click((()=>{$("#calendar-table").fadeOut(),$(".task-container").fadeIn()})),await t()})),$(document).ready((()=>{$(document).on("click",".card-more-icon",(function(){$(".popup-overlay").fadeIn(),$(".modal-popup").fadeIn(),disableScroll();sliderData($(this).closest(".card").find(".card-title").text())})),$(document).on("click",".button-create",(function(){$(".popup-overlay").fadeIn(),$(".modal-popup-create").fadeIn(),disableScroll(),$("#task-title").val(""),$(".task").empty(),addTask()})),$(".popup-overlay").click((function(){$(".popup-overlay").fadeOut(),$(".modal-popup").fadeOut(),$(".modal-popup-create").fadeOut(),enableScroll()})),$(".modal-close").click((async()=>{$(".popup-overlay").fadeOut(),$(".modal-popup").fadeOut(),enableScroll(),await sliderCardWatch()})),$(".modal-close-create").click((function(){$(".popup-overlay").fadeOut(),$(".modal-popup-create").fadeOut(),enableScroll()}))})),$(document).ready((function(){$("#modal-date-create").flatpickr({altInput:!0,altFormat:"F j, Y",dateFormat:"d.m.Y",minDate:"today",defaultDate:"today",locale:"uk",disableMobile:"true"}),$(".add-task-icon").click((()=>{addTask()}))}));